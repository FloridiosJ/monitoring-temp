global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'monitoring. hrt@gmail.com'
  smtp_auth_username: 'monitoring.hrt@gmail. com'
  smtp_auth_password: 'arlu jgzi srng zpkj'
  smtp_require_tls: true

route:
  receiver: 'email-alerts'
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval:  4h
  
  routes:
    - match: 
        severity: critical
      receiver: 'email-critical'
      group_wait: 10s
      repeat_interval: 1h
    
    - match:
        severity:  warning
      receiver: 'email-alerts'
      group_wait: 30s
      repeat_interval: 4h
    
    - match:
        category: monitoring
      receiver: 'email-monitoring'
      group_wait:  15s
      repeat_interval: 2h

receivers:
  - name: 'email-alerts'
    email_configs:
      - to:  'monitoring.hrt@gmail. com'  # ‚Üê Remplacez par votre email
        send_resolved: true
        headers:
          Subject: '‚ö†Ô∏è [{{ . GroupLabels.severity | toUpper }}] {{ .GroupLabels.alertname }}'
        html:  |
          <h2>üîî Alert Notification</h2>
          {{ range . Alerts }}
          <div style="border-left: 4px solid #ffa500; padding: 10px; margin: 10px 0;">
            <h3>{{ .Labels.alertname }}</h3>
            <p><strong>Status:</strong> {{ .Status }}</p>
            <p><strong>Severity:</strong> {{ .Labels.severity }}</p>
            <p><strong>Summary:</strong> {{ .Annotations. summary }}</p>
            <p><strong>Description:</strong> {{ .Annotations.description }}</p>
            <p><strong>Time:</strong> {{ .StartsAt. Format "2006-01-02 15:04:05" }}</p>
          </div>
          {{ end }}
  
  - name: 'email-critical'
    email_configs: 
      - to: 'monitoring.hrt@gmail.com'  # ‚Üê Remplacez par votre email
        send_resolved: true
        headers:
          Subject: 'üö® [CRITICAL] {{ .GroupLabels. alertname }}'
        html: |
          <h2 style="color: #dc3545;">üö® CRITICAL ALERT</h2>
          <p style="color: #dc3545; font-weight: bold;">Immediate attention required!</p>
          {{ range .Alerts }}
          <div style="border-left: 4px solid #dc3545; padding: 10px; margin:  10px 0; background-color: #f8d7da;">
            <h3>{{ . Labels.alertname }}</h3>
            <p><strong>Status:</strong> {{ .Status }}</p>
            <p><strong>Summary:</strong> {{ .Annotations. summary }}</p>
            <p><strong>Description:</strong> {{ .Annotations.description }}</p>
            <p><strong>Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>
          </div>
          {{ end }}
  
  - name: 'email-monitoring'
    email_configs:
      - to: 'monitoring.hrt@gmail.com'  # ‚Üê Remplacez par votre email
        send_resolved: true
        headers: 
          Subject: 'üîß [MONITORING] {{ .GroupLabels. alertname }}'

inhibit_rules:
  - source_match:
      severity:  'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']